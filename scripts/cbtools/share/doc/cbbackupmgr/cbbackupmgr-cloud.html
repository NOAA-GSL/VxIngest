<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.16">
<meta name="description" content="Storing cbbackupmgr archives directly in the cloud">
<meta name="author" content="Couchbase">
<title>cbbackupmgr-cloud(7)</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/*! Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment the following line when using as a custom stylesheet */
/* @import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700"; */
html{font-family:sans-serif;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
b,strong{font-weight:bold}
abbr{font-size:.9em}
abbr[title]{cursor:help;border-bottom:1px dotted #dddddf;text-decoration:none}
dfn{font-style:italic}
hr{height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type=checkbox],input[type=radio]{padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,::before,::after{box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;line-height:1;position:relative;cursor:auto;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:1px solid #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 0 0 .1em #fff;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin:0 auto;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:flex;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:hsla(0,0%,100%,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details{margin-left:1.25rem}
details>summary{cursor:pointer;display:block;position:relative;line-height:1.6;margin-bottom:.625rem;-webkit-tap-highlight-color:transparent}
details>summary::before{content:"";border:solid transparent;border-left:solid;border-width:.3em 0 .3em .5em;position:absolute;top:.5em;left:-1.25rem;transform:translateX(15%)}
details[open]>summary::before{border:solid transparent;border-top:solid;border-width:.5em .3em 0;transform:translateY(15%)}
details>summary::after{content:"";width:1.25rem;height:1em;position:absolute;top:.3em;left:-1.25rem}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class=paragraph]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border:1px solid #e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border:1px solid #dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class=highlight],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos{border-right:1px solid;opacity:.35;padding-right:.5em}
pre.pygments .lineno{border-right:1px solid;opacity:.35;display:inline-block;margin-right:.75em}
pre.pygments .lineno::before{content:"";margin-right:-.125em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans-serif;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd),table.stripes-even tr:nth-of-type(even),table.stripes-hover tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist>li>p:first-child{margin-left:-1em}
ul.checklist>li>p:first-child>.fa-square-o:first-child,ul.checklist>li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist>li>p:first-child>input[type=checkbox]:first-child{margin-right:.25em}
ul.inline{display:flex;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:4px solid #fff;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt,summary{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt,summary{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]{border-bottom:1px dotted}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media amzn-kf8,print{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
</head>
<body class="manpage">
<div id="header">
<h1>cbbackupmgr-cloud(7) Manual Page</h1>
<h2 id="_name">NAME</h2>
<div class="sectionbody">
<p>cbbackupmgr-cloud - Storing cbbackupmgr archives directly in the cloud</p>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="_description">DESCRIPTION</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A document which should give you a basic understanding of how to utilize
cbbackupmgr&#8217;s Enterprise Edition feature, native cloud interactions.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_tutorial">TUTORIAL</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_credentials">CREDENTIALS</h3>
<div class="paragraph">
<p>Backing up directly to an external cloud provider will mean that we require
permissions to access the given data store. Each provider has its own way
of authentication; see the sections below on how to authenticate for your
chosen cloud provider.</p>
</div>
<div class="sect3">
<h4 id="_aws">AWS</h4>
<div class="paragraph">
<p>When using AWS S3, there are multiple different ways that you can supply
credentials to authorize yourself to AWS S3. Below is a list of the
supported techniques:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>When running in EC2, credentials may be obtained via the instance metadata service by setting/supplying:</p>
<div class="ulist">
<ul>
<li>
<p><code>CB_AWS_ENABLE_EC2_METADATA=true</code></p>
</li>
<li>
<p><code>--obj-auth-by-instance-metadata</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>Providing a set of environment variables including:</p>
<div class="ulist">
<ul>
<li>
<p><code>CB_OBJSTORE_REGION</code></p>
</li>
<li>
<p><code>CB_OBJSTORE_ACCESS_KEY_ID</code></p>
</li>
<li>
<p><code>CB_OBJSTORE_SECRET_ACCESS_KEY</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>Loading credentials from the shared config files located at:</p>
<div class="ulist">
<ul>
<li>
<p><code>$HOME/.aws/config</code></p>
</li>
<li>
<p><code>$HOME/.aws/credentials</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>Providing static config/credentials using the cli flags:</p>
<div class="ulist">
<ul>
<li>
<p><code>--obj-access-key-id</code></p>
</li>
<li>
<p><code>--obj-region</code></p>
</li>
<li>
<p><code>--obj-secret-access-key</code></p>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>Setting up cbbackupmgr to interact with AWS should be a very similar process to
setting up the <code>aws-cli</code>. The steps to configure the <code>aws-cli</code> can be found at
<a href="https://docs.aws.amazon.com/cli/latest/userguide/cli-chap-configure.html#cli-quick-configuration" class="bare">https://docs.aws.amazon.com/cli/latest/userguide/cli-chap-configure.html#cli-quick-configuration</a>.</p>
</div>
<div class="paragraph">
<p>For more information about authenticating using the EC2 instance metadata
service, please see the <code>Cloud Provider Specific Features</code> section.</p>
</div>
</div>
<div class="sect3">
<h4 id="_azure_7_1_2">Azure (7.1.2+)</h4>
<div class="paragraph">
<p>As with AWS, there are multiple accepted methods for authorizing against Azure.
Below is a list of the supported techniques:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Providing static credentials using the cli flags:</p>
<div class="ulist">
<ul>
<li>
<p><code>--obj-access-key-id</code></p>
</li>
<li>
<p><code>--obj-secret-access-key</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>Providing a set of environment variables including:</p>
<div class="ulist">
<ul>
<li>
<p><code>AZURE_STORAGE_ACCOUNT</code></p>
</li>
<li>
<p><code>AZURE_STORAGE_KEY</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>Providing a connection string via an environment variable:</p>
<div class="ulist">
<ul>
<li>
<p><code>AZURE_STORAGE_CONNECTION_STRING</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>Obtaining a service principle token through the environment, using:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Client credentials</p>
<div class="ulist">
<ul>
<li>
<p><code>AZURE_CLIENT_ID</code></p>
</li>
<li>
<p><code>AZURE_TENANT_ID</code></p>
</li>
<li>
<p><code>AZURE_CLIENT_SECRET</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>A client certificate</p>
<div class="ulist">
<ul>
<li>
<p><code>AZURE_CLIENT_ID</code></p>
</li>
<li>
<p><code>AZURE_TENANT_ID</code></p>
</li>
<li>
<p><code>AZURE_CERTIFICATE_PATH</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>A username/password</p>
<div class="ulist">
<ul>
<li>
<p><code>AZURE_CLIENT_ID</code></p>
</li>
<li>
<p><code>AZURE_TENANT_ID</code></p>
</li>
<li>
<p><code>AZURE_USERNAME</code></p>
</li>
<li>
<p><code>AZURE_PASSWORD</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>A managed identity</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>When using Azure Active Directory to authenticate, <code>cbbackupmgr</code> may not be able to determine the storage account name
and, as a consequence, the URL that it should use to connect to the Azure Blob Storage service. In this case it will
return an error such as the one below.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>failed to determine account name, checked '--obj-access-key-id', 'AZURE_STORAGE_ACCOUNT' and
'AZURE_STORAGE_CONNECTION_STRING'</pre>
</div>
</div>
<div class="paragraph">
<p>The account name will need to be supplied by using one of the following options:
- The <code>--obj-access-key-key</code> flag
- The <code>AZURE_STORAGE_ACCOUNT</code> environment variable
- The <code>AZURE_STORAGE_CONNECTION_STRING</code> environment variable (by specifically setting the <code>AccountName</code> key)</p>
</div>
</div>
<div class="sect3">
<h4 id="_gcp">GCP</h4>
<div class="paragraph">
<p>As with AWS/Azure, GCP supports multiple methods of authenticating. Below is a
list of the supported techniques:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Providing static credentials using the cli flags:</p>
<div class="ulist">
<ul>
<li>
<p><code>--obj-access-key-id</code></p>
</li>
<li>
<p><code>--obj-secret-access-key</code></p>
</li>
<li>
<p><code>--obj-refresh-token</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>Providing an SDK style auth file</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Using a static flag</p>
<div class="ulist">
<ul>
<li>
<p><code>--obj-auth-file</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>Using an environment variable</p>
<div class="ulist">
<ul>
<li>
<p><code>GOOGLE_APPLICATION_CREDENTIALS</code></p>
</li>
</ul>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Using a "well known" credentials file</p>
<div class="ulist">
<ul>
<li>
<p><code>$HOME/.config/gcloud/application_default_credentials.json</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>Using the first generation app engine runtime</p>
</li>
<li>
<p>Using the metadata service when running in Google Compute Engine</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_the_staging_directory">THE STAGING DIRECTORY</h3>
<div class="paragraph">
<p>One of the most important concepts behind how backup to object store works is
the staging directory. The staging directory is a location on disk where
temporary data is stored during the execution of a sub-command. For a
backup/restore this will be DCP metadata and storage indexes.</p>
</div>
<div class="paragraph">
<p>When creating an archive to store in a cloud provider you are required to
provide a location for the <code>obj-staging-dir</code>. This is a local location where
archive meta data will be stored. During a backup, files will be stored here
before they are uploaded to the cloud. Note that cbbackupmgr doesn&#8217;t store any
document values in the staging directory; they are streamed directly to the
cloud.</p>
</div>
<div class="paragraph">
<p>Each cloud archive must have a unique staging directory i.e. they can&#8217;t be
shared. cbbackupmgr will detect cases where the staging directory is being
reused across archives.</p>
</div>
<div class="paragraph">
<p>Any modifications to the cloud archive (using the web-ui or cli tools) and not
cbbackupmgr are not supported whilst using the same staging directory. If a
cloud archive has been modified, the staging directory should be removed and
recreated before using cbbackupmgr to interact with the archive again.</p>
</div>
<div class="paragraph">
<p>The staging directory is only used during operations e.g. backup/restore and
can be safely deleted once an operation completes; this is because all the files
will have been uploaded to the cloud.</p>
</div>
<div class="paragraph">
<p>The staging directory can become quite large during a normal backup depending
on the number of documents being backed up, and the size of their keys. See the
<code>Disk requirements</code> section for more information about how to provision the
staging directory.</p>
</div>
</div>
<div class="sect2">
<h3 id="_configuring_cloud_backups">CONFIGURING CLOUD BACKUPS</h3>
<div class="paragraph">
<p>The first step is to create a backup archive in object store. This can be done with
the <code>config</code> command and only needs to be done once. All other commands will
automatically download the archive meta data in the directory provided via the <code>obj-staging-dir</code>
argument prior to performing any operations; this is done regardless of whether the archive
exists locally because we must ensure the archive in the staging directory is up to date.
Below is an example of how you would configure an archive in AWS S3.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ cbbackupmgr config -a s3://bucket/archive -r repo --obj-staging-dir /mnt/staging

Backup repository `repo` created successfully in archive `s3://bucket/archive`</pre>
</div>
</div>
<div class="paragraph">
<p>Assuming your credentials are correct, the archive should now reside directly in the
provided S3 bucket. To verify, you could use the <code>aws-cli</code> to list the contents off the
bucket and they should be identical to that which would exist for a local backup.</p>
</div>
<div class="paragraph">
<p>Although it&#8217;s possible to have cbbackupmgr coexist in the same S3 bucket as other general
purpose storage, we recommend using a bucket which cbbackupmgr has exclusive access too.</p>
</div>
</div>
<div class="sect2">
<h3 id="_backing_up_a_cluster">BACKING UP A CLUSTER</h3>
<div class="paragraph">
<p>Once an archive is configured performing a backup works in a similar fashion to performing a local
backup. It&#8217;s important to note that when backing up directly to S3 a certain amount of disk
space will be used to stage local meta data files and storage indexes. See the
<code>Staging Directory</code> section for more information. Below is an example of
doing a backup and storing directly in AWS S3.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ cbbackupmgr backup -a s3://bucket/archive -r repo --obj-staging-dir /mnt/staging \
  -c http://10.101.101.112:8091 -u Administrator -p password

Copied all data in 1m2.525397237s (Avg. 51.61KB/Sec)      7303 items / 3.12MB
beer-sample             [===========================================] 100.00%

Backup successfully completed
Backed up bucket "beer-sample" succeeded
Mutations backedup; 7303, Mutations failed to backup: 0
Deletions backedup: 0, Deletions failed to backup: 0</pre>
</div>
</div>
<div class="paragraph">
<p>Performing incremental backups works exactly as it would if you were performing an incremental
locally; simply rerun the command above and an incremental backup would be created.</p>
</div>
<div class="paragraph">
<p>When choosing the amount of threads to use it&#8217;s important to consider that when backing up to the
cloud, cbbackupmgr buffers data in memory before uploading it. This means that choosing an extremely
large amount of threads when using a poor internet connection could lead to a scenario where your
machine runs out of memory.</p>
</div>
<div class="paragraph">
<p>To learn more about backup options see <a href="cbbackupmgr-backup.html">cbbackupmgr-backup(1)</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_restoring_a_backup_multiple_incremental_backups">RESTORING A BACKUP / MULTIPLE INCREMENTAL BACKUPS</h3>
<div class="paragraph">
<p>Once you have created a backup, restoring it works in a similar way to restoring a local
backup. It&#8217;s worth noting that restoring a backup to a cluster that&#8217;s hosted outside of AWS
is likely to be significantly more expensive than performing a backup (depending on the size of
your dataset). See Costing for more information.</p>
</div>
<div class="paragraph">
<p>Below is an example of restoring a backup that is store in AWS S3.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ cbbackupmgr restore -a s3://bucket/archive -r repo --obj-staging-dir /mnt/staging \
  -c http://10.101.101.112:8091 -u Administrator -p password

(1/1) Restoring backup 2020-03-19T15_35_00.467487218Z
Copied all data in 28.048019272s (Avg. 103.21KB/Sec)     7303 items / 2.82MB
beer-sample             [==========================================] 100.00%

Restore bucket 'beer-sample' succeeded
Mutations restored: 7303, Mutations failed to restore: 0
Deletions restored: 0, Deletions failed to restore: 0
Skipped due to purge number or conflict resolution: Mutations: 0 Deletions: 0
Restore completed successfully</pre>
</div>
</div>
<div class="sect3">
<h4 id="_disk_requirements">DISK REQUIREMENTS</h4>
<div class="paragraph">
<p>As discussed in <code>Staging Directory</code>, you will be required to provision enough
disk space to store all the keys for your dataset on disk during a backup. We
would recommend doing a simple calculation to determine the approximate size of
the staging directory.</p>
</div>
<div class="paragraph">
<p>Using the formula below, you can calculate the approximate size of the staging
directory in Gigabytes:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>(${NUMBER_OF_ITEMS} * (${AVERAGE_KEY_SIZE_IN_BYTES} + 30)) / (1024 ^ 3)</pre>
</div>
</div>
<div class="paragraph">
<p>Note that this is a rough estimate which doesn&#8217;t account for factors such as
fragmentation, however, it should be a good starting point. Using this formula
and given a dataset with 50 Million keys with an average size of 75 bytes, we&#8217;d
expect to need to provision about 5GiB of disk space.</p>
</div>
<div class="paragraph">
<p>When approximating the size of the staging directory, we don&#8217;t need to account
for the size of the document values because they are never stored on disk; they
are uploaded directly to object store.</p>
</div>
</div>
<div class="sect3">
<h4 id="_costing">COSTING</h4>
<div class="paragraph">
<p>Before using any <code>cbbackupmgr</code> sub-commands, it&#8217;s worth ensuring that you
understand the costing related to using your chosen cloud provider; often the
pattern being that it&#8217;s cheap to upload/store data, but (comparatively)
expensive to access/download (to the wider internet). We recommend using one of
the following calculators.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">AWS</dt>
<dd>
<p><a href="https://calculator.s3.amazonaws.com/index.html" class="bare">https://calculator.s3.amazonaws.com/index.html</a></p>
</dd>
<dt class="hdlist1">Azure</dt>
<dd>
<p><a href="https://azure.microsoft.com/en-gb/pricing/calculator" class="bare">https://azure.microsoft.com/en-gb/pricing/calculator</a></p>
</dd>
<dt class="hdlist1">GCP</dt>
<dd>
<p><a href="https://cloud.google.com/products/calculator" class="bare">https://cloud.google.com/products/calculator</a></p>
</dd>
</dl>
</div>
<div class="sect4">
<h5 id="_backup">BACKUP</h5>
<div class="paragraph">
<p>Backing up data from outside/inside AWS S3 is cheap; this is because at the time of writing,
it doesn&#8217;t cost anything to transfer data into S3 (you only pay for the storage/requests).</p>
</div>
</div>
<div class="sect4">
<h5 id="_restore">RESTORE</h5>
<div class="paragraph">
<p>Restoring data is another matter, AWS S3 charges users for pulling data from AWS onto the
internet. This means that restoring large datasets can become quite costly if your cluster
is not in AWS. Before performing a restore, use info (as described below in Interrogating
backups) to determine the size of your backup. You can then use this to calculate how much
it will cost to restore your backup.</p>
</div>
<div class="paragraph">
<p>At the time of writing, restoring a backup to a cluster stored inside AWS S3 will not be
significantly costly since AWS do not charge for the bandwidth inside AWS. No matter
whether your cluster is hosted in/outside AWS it&#8217;s worth calculating the costs before
performing a restore.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_merging">MERGING</h3>
<div class="paragraph">
<p>One of the main reasons for merging incremental backups is to save disk space. In AWS S3
space is cheap and bandwidth (to the broader internet) is expensive. This means that there
isn&#8217;t a financially viable reason for merging cloud backups. For this reason merging incremental
backups stored in the cloud is not supported.</p>
</div>
<div class="paragraph">
<p>Restoring will continue to support applying incremental backups in chronological order in the
same fashion that it&#8217;s would when merging e.g. you will end up with the same data in your
Couchbase cluster.</p>
</div>
</div>
<div class="sect2">
<h3 id="_interrogating_backups">INTERROGATING BACKUPS</h3>
<div class="paragraph">
<p>Several tools have been made available for use with archives stored directly in the
cloud, currently these are:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">examine</dt>
<dd>
<p><a href="cbbackupmgr-examine.html">cbbackupmgr-examine(1)</a></p>
</dd>
<dt class="hdlist1">info</dt>
<dd>
<p><a href="cbbackupmgr-info.html">cbbackupmgr-info(1)</a></p>
</dd>
</dl>
</div>
<div class="sect3">
<h4 id="_examine">EXAMINE</h4>
<div class="paragraph">
<p>Examine can be used to query whether a document with the given key exists in given
collection (possibly across multiple backups), the examine tools supports directly
querying the data in S3.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ cbbackupmgr examine -a s3://bucket/archive -r repo --obj-staging-dir /mnt/staging \
 --collection-string beer-sample --key '21st_amendment_brewery_cafe'

   Key: 21st_amendment_brewery_cafe
   SeqNo: 5
   Backup: 2020-01-08T17_21_20.232087665Z
   Deleted: false
   Size: 27B (key), 29B (meta), 666B (value)
   Meta: {"flags":33554432,"cas":1578502228728479744,"revseqno":1,"datatype":1}
   Value: {"address":["563 Second Street"],"city":"San Francisco","code":"94107","country":"United States","description":"The 21st Amendment Brewery offers a variety of award winning house made brews and American grilled cuisine in a comfortable loft like setting. Join us before and after Giants baseball games in our outdoor beer garden. A great location for functions and parties in our semi-private Brewers Loft. See you soon at the 21A!","geo":{"accuracy":"ROOFTOP","lat":37.7825,"lon":-122.393},"name":"21st Amendment Brewery Cafe","phone":"1-415-369-0900","state":"California","type":"brewery","updated":"2010-10-24 13:54:07","website":"http://www.21st-amendment.com/"}</pre>
</div>
</div>
<div class="paragraph">
<p>To learn more about examine options see <a href="cbbackupmgr-examine.html">cbbackupmgr-examine(1)</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_info">INFO</h4>
<div class="paragraph">
<p>The info command can be used to query a broader archive to understand its structure and to gain
an understanding of what data is backed up and where.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ cbbackupmgr info -a s3://bucket/archive -r repo --obj-staging-dir /mnt/staging

Name  | Size  | # Backups  |
rift  | 796B  | 1          |

  +  Backup                          | Size  | Type  | Source                  | Range  | Events  | Aliases  | Complete  |
  +  2020-01-08T17_21_20.232087665Z  | 796B  | FULL  | http://172.20.1.1:8091  | N/A    | 0       | 0        | true      |

    -    Bucket       | Size  | Items  | Mutations  | Tombstones  | Views  | FTS  | Indexes  | CBAS  |
    -    beer-sample  | 790B  | 7303   | 7303       | 0           | 1      | 0    | 0        | 0     |</pre>
</div>
</div>
<div class="paragraph">
<p>To learn more about info options see <a href="cbbackupmgr-info.html">cbbackupmgr-info(1)</a>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_archive_locking">ARCHIVE LOCKING</h3>
<div class="paragraph">
<p>It&#8217;s important that only one instance of cbbackupmgr has access to the archive at a time; this is
enforced using a lockfile meaning most of the time you shouldn&#8217;t need to worry about this. However,
there are some situations where cbbackupmgr may fail to ensure exclusive access to the archive:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Another process (on another machine, or the local machine) already has an active lockfile.</p>
</li>
<li>
<p>A stale lockfile exists which belongs to a system with a different hostname.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>In cases where cbbackupmgr fails to lock an archive a few simple steps can be taken:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Manually ensure that nobody else is using the archive</p>
</li>
<li>
<p>If you are certain nobody else is using the archive, locate the lockfile in S3 (it has the
format <code>lock-${UUID}.lk</code> and is stored in the top-level of the archive).</p>
</li>
<li>
<p>Remove the lockfile and try to continue using the archive with your own instance of cbbackupmgr.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>It&#8217;s extremely important that you only manually remove the lockfile if you a certain that there
isn&#8217;t another instance of cbbackupmgr using the archive. Having two instances of cbbackupmgr running
against the same archive could cause data loss through overlapping key prefixes.</p>
</div>
<div class="paragraph">
<p>Below is an example of an archive which contains a lockfile from a system that crashed where the
lockfile was never cleaned up.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ aws s3 ls s3://backups --recursive
2020-04-27 09:34:10        120 archive/.backup
2020-04-27 09:34:23         34 archive/lock-14eb923b-60a7-480a-849e-8af48e47f9ea.lk
2020-04-27 09:34:10        520 archive/logs/backup-0.log
2020-04-27 09:34:10        651 archive/repo/backup-meta.json</pre>
</div>
</div>
<div class="paragraph">
<p>If we attempt to use cbbackupmgr to create a backup, we should see a message similar to the one
below:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ cbbackupmgr backup -a s3://bucket/archive -r repo --obj-staging-dir /mnt/staging \
  -c 172.20.1.1:8091 -u admin -p password
Error backing up cluster: the process '{PID}' running on '{HOSTNAME}' already holds the lock</pre>
</div>
</div>
<div class="paragraph">
<p>In this case, cbbackupmgr will not remove the lock automatically since it cannot safely determine
whether the other process is active or not. We can use the information about which machine the other
instance of cbbackupmgr is running on to check whether it is active. If this machine has crashed and
that instance of cbbackupmgr is no longer using the archive, we can manually remove the lockfile.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ aws s3 rm s3://backups/archive/lock-14eb923b-60a7-480a-849e-8af48e47f9ea.lk
delete: s3://backups/archive/lock-14eb923b-60a7-480a-849e-8af48e47f9ea.lk</pre>
</div>
</div>
<div class="paragraph">
<p>If we attempt to perform the backup once again we will see that it continues successfully; in the
case that the other machine failed during a backup you may be asked to purge the previous backup
using the <code>--purge</code> flag before you can create a new backup:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ cbbackupmgr backup -a s3://bucket/archive -r repo --obj-staging-dir /mnt/staging \
  -c 172.20.1.1:8091 -u admin -p password

Copied all data in 1m2.525397237s (Avg. 51.61KB/Sec)      7303 items / 3.12MB
beer-sample             [===========================================] 100.00%

Backup successfully completed
Backed up bucket "beer-sample" succeeded
Mutations backedup; 7303, Mutations failed to backup: 0
Deletions backedup: 0, Deletions failed to backup: 0</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_compatible_object_stores">COMPATIBLE OBJECT STORES</h2>
<div class="sectionbody">
<div class="paragraph">
<p>cbbackupmgr is tested against the cloud providers that are supported, however, in some cases it will
work with compatible object stores e.g. Localstack/Scality. It&#8217;s important to note that experience
may be different when interacting with compatible object stores because some have slightly different
behaviors which cbbackupmgr may not explicitly handle.</p>
</div>
<div class="sect2">
<h3 id="_aws_2">AWS</h3>
<div class="paragraph">
<p>It should be possible to use cbbackupmgr with S3 compatible object stores, however, there are some
things that need to be taken into consideration. First and foremost is the features that cbbackupmgr
leverages. Below is a list of S3 API features that cbbackupmgr uses but not all compatible object
stores support:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>ListObjectsV2 <a href="https://docs.aws.amazon.com/AmazonS3/latest/API/API_ListObjectsV2.html" class="bare">https://docs.aws.amazon.com/AmazonS3/latest/API/API_ListObjectsV2.html</a></p>
</li>
<li>
<p>MultipartUploads <a href="https://docs.aws.amazon.com/AmazonS3/latest/dev/mpuoverview.html" class="bare">https://docs.aws.amazon.com/AmazonS3/latest/dev/mpuoverview.html</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>It&#8217;s important that you check whether these features are implemented on your S3 compatible object
store because without them cbbackupmgr will not work as expected.</p>
</div>
<div class="paragraph">
<p>AWS also has a slightly newer virtual addressing style the documentation for which can be found at
<a href="https://docs.aws.amazon.com/AmazonS3/latest/dev/VirtualHosting.html" class="bare">https://docs.aws.amazon.com/AmazonS3/latest/dev/VirtualHosting.html</a>. Not all S3 compatible object
stores support this style of addressing. The errors that are returned by the SDK (and therefore
cbbackupmgr) in these cases are not always clear. Before raising a support ticket about cbbackupmgr
not working with an S3 compatible object store you should first try using the
<code>--s3-force-path-style</code> argument. This will force cbbackupmgr to use the old path style addressing.
From our testing with S3 compatible object stores it&#8217;s very common for this flag to be required.</p>
</div>
</div>
<div class="sect2">
<h3 id="_azuregcp">Azure/GCP</h3>
<div class="paragraph">
<p>As with AWS S3 support, Azure/GCP should work compatible object storage
solutions. You also shouldn&#8217;t need to provide any specific flags when using
compatible storage solutions.</p>
</div>
<div class="paragraph">
<p>It should however, be noted that Azure/GCP will only work when the underlying
compatible object storage solution implements all the required features and it
should be noted that this behavior is not exhaustively validated by Couchbase.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_cloud_provider_specific_features">CLOUD PROVIDER SPECIFIC FEATURES</h2>
<div class="sectionbody">
<div class="paragraph">
<p>As stated above in the 'Compatible Object Stores' section it&#8217;s possible to use cbbackupmgr with
other providers which expose an S3 compatible API. It&#8217;s important to note that some
features may only be accessible to those using the AWS.</p>
</div>
<div class="sect2">
<h3 id="_aws_3">AWS</h3>
<div class="paragraph">
<p>When running cbbackupmgr in an AWS instance, it may use the EC2 instance metadata to get
credentials. This is disabled by default, however, may be enabled by either supplying the
<code>--obj-auth-by-instance-metadata</code> flag or setting the <code>CB_AWS_ENABLE_EC2_METADATA</code> environment
variable to <code>true</code>.</p>
</div>
<div class="paragraph">
<p>For example, if we wanted to use cbbackupmgr with the EC2 instance metadata we would:
. Create a role with a policy which allows S3 data manipulation (e.g. S3 Full Admin)
. Attach that role to the instance
.. Run <code>export CB_AWS_ENABLE_EC2_METADATA=true</code> to enable fetching EC2 instance metadata
.. Add the <code>--obj-auth-by-instance-metadata</code> flag to your cbbackupmgr command.
. Run cbbackupmgr as described elsewhere in this tutorial</p>
</div>
</div>
<div class="sect2">
<h3 id="_azure_7_1_2_2">Azure (7.1.2+)</h3>
<div class="paragraph">
<p>When running in an Azure VM, <code>cbbackupmgr</code> will attempt to fetch a service
principle token from the environment which will be used to authenticate against
blob storage. In this case, the correct RBAC permissions should be provided to
allow <code>cbbackupmgr</code> access to the chosen storage account. As apposed to AWS,
this behavior is enabled by default.</p>
</div>
</div>
<div class="sect2">
<h3 id="_gcp_2">GCP</h3>
<div class="paragraph">
<p>When running in Google Compute, <code>cbbackupmgr</code> will using the instance metadata
server to fetch credentials which may be used to authenticate against Google
Storage. As with AWS/Azure, the correct RBAC permissions should be provided to
allow <code>cbbackupmgr</code> access to the given bucket. As apposed to AWS, this
behavior is enabled by default.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_rbac">RBAC</h2>
<div class="sectionbody">
<div class="paragraph">
<p>It&#8217;s quite common to run <code>cbbackupmgr</code> with an account with limited permissions, this section covers
any cloud provider specific permissions which are required. Please note that any permissions listed
in the following sections are subject to change between releases.</p>
</div>
<div class="sect2">
<h3 id="_aws_4">AWS</h3>
<div class="paragraph">
<p>The following is a list of the actions required by <code>cbbackupmgr</code> when interacting with a remote
archive in AWS.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>AbortMultipartUpload</code></p>
</li>
<li>
<p><code>CompleteMultipartUpload</code></p>
</li>
<li>
<p><code>CreateMultipartUpload</code></p>
</li>
<li>
<p><code>DeleteObject</code></p>
</li>
<li>
<p><code>DeleteObjects</code></p>
</li>
<li>
<p><code>GetObject</code></p>
</li>
<li>
<p><code>HeadObject</code></p>
</li>
<li>
<p><code>ListObjectsV2</code></p>
</li>
<li>
<p><code>ListObjects</code></p>
</li>
<li>
<p><code>ListParts</code></p>
</li>
<li>
<p><code>PutObject</code></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_azure">Azure</h3>
<div class="paragraph">
<p>The following are the required RBAC roles required by <code>cbbackupmgr</code> when
interacting with a remote archive in Azure.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Storage Blob Data Owner</code> or <code>Storage Blob Data Contributor</code></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_gcp_3">GCP</h3>
<div class="paragraph">
<p>The following are the required RBAC roles required by <code>cbbackupmgr</code> when
interacting with a remote archive in GCP.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Storage Object Admin</code></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_see_also">SEE ALSO</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="cbbackupmgr-config.html">cbbackupmgr-config(1)</a>,
<a href="cbbackupmgr-backup.html">cbbackupmgr-backup(1)</a>,
<a href="cbbackupmgr-restore.html">cbbackupmgr-restore(1)</a>,
<a href="cbbackupmgr-merge.html">cbbackupmgr-merge(1)</a>,
<a href="cbbackupmgr-examine.html">cbbackupmgr-examine(1)</a>
<a href="cbbackupmgr-info.html">cbbackupmgr-info(1)</a></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_cbbackupmgr">CBBACKUPMGR</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Part of the <a href="cbbackupmgr.html">cbbackupmgr(1)</a> suite</p>
</div>
</div>
</div>
</div>
</body>
</html>