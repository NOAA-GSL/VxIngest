'\" t
.\"     Title: cbbackupmgr-collect-logs
.\"    Author: Couchbase
.\" Generator: Asciidoctor 2.0.16
.\"      Date: 2023-09-20
.\"    Manual: Couchbase Server Manual
.\"    Source: Couchbase Server 7.2.2-6401
.\"  Language: English
.\"
.TH "CBBACKUPMGR\-COLLECT\-LOGS" "1" "2023-09-20" "Couchbase Server 7.2.2\-6401" "Couchbase Server Manual"
.ie \n(.g .ds Aq \(aq
.el       .ds Aq '
.ss \n[.ss] 0
.nh
.ad l
.de URL
\fI\\$2\fP <\\$1>\\$3
..
.als MTO URL
.if \n[.g] \{\
.  mso www.tmac
.  am URL
.    ad l
.  .
.  am MTO
.    ad l
.  .
.  LINKSTYLE blue R < >
.\}
.SH "NAME"
cbbackupmgr-collect-logs \- Collects debugging information from a backup archive
.SH "SYNOPSIS"
.sp
.nf
cbbackupmgr collect\-logs [\-\-archive <archive_dir>] [\-\-output\-dir <dir>]
                         [\-\-redact] [\-\-salt <salt>] [\-\-upload\-host <url>]
                         [\-\-customer <customer\-name>] [\-\-upload\-proxy <proxy>]
                         [\-\-ticket <ticket\-number>] [\-\-obj\-access\-key\-id <access_key_id>]
                         [\-\-obj\-cacert <cert_path>] [\-\-obj\-endpoint <endpoint>]
                         [\-\-obj\-no\-ssl\-verify] [\-\-obj\-region <region>]
                         [\-\-obj\-staging\-dir <staging_dir>] [\-\-obj\-secret\-access\-key <secret_access_key>]
                         [\-\-s3\-force\-path\-style]
.fi
.br
.SH "DESCRIPTION"
.sp
Collects debugging information to make it easier to debug user issues. This
command collects the logs, the output of the info command, the range.json files
from each backup, the seqnos and failover logs from each backup, and the
backup_meta.json files from each repo. This data is put into a zip file that
contains the date that the collect\-info command was run. This command will only
collect meta from the backup archive.
.SH "OPTIONS"
.sp
Below are a list of parameters for the compact command.
.SS "Required"
.sp
\-a,\-\-archive <archive_dir>
.RS 4
The location of the archive directory.
.RE
.sp
\-o,\-\-output\-dir <dir>
.RS 4
Specifies a path where the zip file that this command writes should be
written. If this flag is not used then the zip file is written to the logs
directory of the archive the command is run against.
.RE
.SS "Optional"
.sp
\-\-redact
.RS 4
When the redact flag is specified a redacted copy of the logs will be
produced, in the same directory as the unredacted version. The redacted
zip directory will be prefixed by `redacted\-`.
.RE
.sp
\-\-salt <salt>
.RS 4
Specifies the salt to used to hash the data. If possible the salt should be
the same used by Couchbase Server to allow the logs to be easily cross
referenced. The Couchbase Server salt is at the top of the couchbase.log in
the zip file generated by cbcollect_info. If no salt is specified it will be
auto\-generated.
.RE
.sp
\-\-upload\-host <url>
.RS 4
Specifies the fully\-qualified domain name of the host you want the logs
uploaded to. The protocol prefix of the domain name, https://, is optional.
It is the default\-only supported protocol.
.RE
.sp
\-\-customer <customer\-name>
.RS 4
Specifies the customer name. This value must be a string whose maximum length
is 50 characters. Only the following characters can be used: [A\-Za\-z0\-9_.\-].
If any other characters are included, the request is rejected.
.RE
.sp
\-\-upload\-proxy <upload\-proxy>
.RS 4
Specifies a proxy for upload.
.RE
.sp
\-\-ticket <ticket\-number>
.RS 4
Specifies the Couchbase Support ticket\-number. The value must be a string
with a maximum length of 7 characters, containing only digits in the range of
0\-9.
.RE
.SS "Cloud integration"
.sp
Native cloud integration is an Enterprise Edition feature which was introduced
in Couchbase Server 6.6.0.
.sp
Multiple cloud providers are supported, see the list below for more information.
.sp
.RS 4
.ie n \{\
\h'-04' 1.\h'+01'\c
.\}
.el \{\
.  sp -1
.  IP " 1." 4.2
.\}
Supported
.sp
.RS 4
.ie n \{\
\h'-04'\(bu\h'+03'\c
.\}
.el \{\
.  sp -1
.  IP \(bu 2.3
.\}
AWS S3 (\f(CRs3://\fP)
.RE
.sp
.RS 4
.ie n \{\
\h'-04'\(bu\h'+03'\c
.\}
.el \{\
.  sp -1
.  IP \(bu 2.3
.\}
GCP Google Storage (\f(CRgs://\fP)
.RE
.sp
.RS 4
.ie n \{\
\h'-04'\(bu\h'+03'\c
.\}
.el \{\
.  sp -1
.  IP \(bu 2.3
.\}
Azure Blob Storage in 7.1.2+ (\f(CRaz://\fP)
.RE
.RE
.SS "Required"
.sp
\-\-obj\-staging\-dir <staging_dir>
.RS 4
When performing an operation on an archive which is located in the cloud such
as AWS, the staging directory is used to store local meta data files. This
directory can be temporary (it\(cqs not treated as a persistent store) and is
only used during the backup. NOTE: Do not use \f(CR/tmp\fP as the \f(CRobj\-staging\-dir\fP.
See \f(CRDisk requirements\fP in \fBcbbackupmgr\-cloud\fP(7) for more information.
.RE
.SS "Optional"
.sp
\-\-obj\-access\-key\-id <access_key_id>
.RS 4
The access key id which has access to your chosen object store. This option
can be omitted when using the shared config functionality provided by your
chosen object store. Can alternatively be provided using the
\f(CRCB_OBJSTORE_ACCESS_KEY_ID\fP environment variable.
.sp
When using AWS, this option expects an access key id. See
\c
.URL "https://docs.aws.amazon.com/general/latest/gr/aws\-sec\-cred\-types.html#access\-keys\-and\-secret\-access\-keys" ""
for more information.
.sp
When using Azure, this option expects an account name. See
\c
.URL "https://docs.microsoft.com/en\-us/azure/storage/common/storage\-account\-overview#storage\-account\-endpoints" ""
for more information.
.sp
When using GCP, this option expects a client id. See
.URL "https://cloud.google.com/storage/docs/authentication" "" ""
for more information.
.RE
.sp
\-\-obj\-cacert <cert_path>
.RS 4
Specifies a CA certificate that will be used to verify the identity of the
object store being connected to.
.RE
.sp
\-\-obj\-endpoint <endpoint>
.RS 4
The host/address of your object store.
.RE
.sp
\-\-obj\-no\-ssl\-verify
.RS 4
Skips the SSL verification phase when connecting to the object store.
Specifying this flag will allow a connection using SSL encryption, but you
are vulnerable to a man\-in\-the\-middle attack.
.RE
.sp
\-\-obj\-region <region>
.RS 4
The region in which your bucket/container resides. For AWS this option may be
omitted when using the shared config functionality. See the AWS section of
the cloud documentation for more information.
.RE
.sp
\-\-obj\-secret\-access\-key <secret_access_key>
.RS 4
The secret access key which has access to you chosen object store. This
option can be omitted when using the shared config functionality provided by
your chosen object store. Can alternatively be provided using the
\f(CRCB_OBJSTORE_SECRET_ACCESS_KEY\fP environment variable.
.sp
When using AWS, this option expects a secret access key. See
\c
.URL "https://docs.aws.amazon.com/general/latest/gr/aws\-sec\-cred\-types.html#access\-keys\-and\-secret\-access\-keys" ""
for more information.
.sp
When using Azure, this option expects an account key. See
\c
.URL "https://docs.microsoft.com/en\-us/azure/storage/common/storage\-account\-keys\-manage?tabs=azure\-portal" ""
for more information.
.sp
When using GCP, this option expects a client secret. See
.URL "https://cloud.google.com/storage/docs/authentication" "" ""
for more information.
.RE
.sp
\-\-obj\-log\-level <level>
.RS 4
Set the log level for the cloud providers SDK. By default logging will be
disabled. Valid options are cloud provider specific and are listed below.
.sp
The valid options for the AWS SDK are \f(CRdebug\fP, \f(CRdebug\-with\-signing\fP,
\f(CRdebug\-with\-body\fP, \f(CRdebug\-with\-request\-retries\fP, \f(CRdebug\-with\-request\-errors\fP,
and \f(CRdebug\-with\-event\-stream\-body\fP.
.sp
The valid options for the Azure SDK are \f(CRinfo\fP, \f(CRdebug\fP, \f(CRdebug\-with\-request\-retries\fP and
\f(CRdebug\-with\-request\-retries\-and\-lro\fP.
.sp
The Google Storage SDK does not expose advanced logging configuration meaning
this option is explicitly ignored, however, this behavior may change in the
future.
.RE
.sp
\-\-obj\-auth\-by\-instance\-metadata
.RS 4
Depending on the cloud provider, using instance metadata for authentication
is disabled by default. Supplying this flag will allow the fetching
credentials/auth tokens from (VM) internal instance metadata endpoints.
.sp
By default, this option is disabled for AWS.
.sp
By default, this option is enabled for Azure.
.sp
By default, this option is enabled for GCP.
.RE
.sp
\-\-obj\-auth\-file
.RS 4
GCP offers the ability to use a file which contains credentials which will be
used to perform authentication. The \f(CR\-\-obj\-auth\-file\fP flag accepts a path to
an authentication file. This flag is unsupported for the AWS/Azure cloud
providers.
.RE
.sp
\-\-obj\-refresh\-token
.RS 4
GCP requires a refresh token when using static credentials, this will be used
to refresh oauth2 tokens when accessing remote storage.
.RE
.SS "AWS S3 Options"
.SS "Optional"
.sp
\-\-s3\-force\-path\-style
.RS 4
By default the updated virtual style paths will be used when interfacing with
AWS S3. This option will force the AWS SDK to use the alternative path style
URLs which are often required by S3 compatible object stores.
.RE
.SH "EXAMPLES"
.sp
To generate debugging information for an archive dir "/data/backup" and output
the file to "/data/output/logs" run the following command.
.sp
.if n .RS 4
.nf
.fam C
$ cbbackupmgr collect\-logs \-a /data/backup
.fam
.fi
.if n .RE
.sp
To generate debugging information for an archive dir "/data/backup" and output
the file to "/tmp" run the following command.
.sp
.if n .RS 4
.nf
.fam C
$ cbbackupmgr collect\-logs \-a /data/backup \-o /tmp
.fam
.fi
.if n .RE
.sp
To upload the logs directly to support use:
.sp
.if n .RS 4
.nf
.fam C
$ cbbackupmgr collect\-logs \-a /data/backup \-o /tmp \(rs
  \-\-upload\-host uploads.couchbase.com \(rs
\-\-customer CUSTOMER_NAME \-\-ticket 378211
.fam
.fi
.if n .RE
.SH "ENVIRONMENT AND CONFIGURATION VARIABLES"
.sp
CB_ARCHIVE_PATH
.RS 4
Specifies the path to the backup archive. If the archive path is supplied as
a command line argument then this value is overridden.
.RE
.sp
CB_OBJSTORE_STAGING_DIRECTORY
.RS 4
Specifies the path to the staging directory. If the \f(CR\-\-obj\-staging\-dir\fP
argument is provided in the command line then this value is overridden.
.RE
.sp
CB_OBJSTORE_REGION
.RS 4
Specifies the object store region. If the \f(CR\-\-obj\-region\fP argument is provided
in the command line then this value is overridden.
.RE
.sp
CB_OBJSTORE_ACCESS_KEY_ID
.RS 4
Specifies the object store access key id. If the \f(CR\-\-obj\-access\-key\-id\fP
argument is provided in the command line this value is overridden.
.RE
.sp
CB_OBJSTORE_SECRET_ACCESS_KEY
.RS 4
Specifies the object store secret access key. If the
\f(CR\-\-obj\-secret\-access\-key\fP argument is provided in the command line this value
is overridden.
.RE
.sp
CB_OBJSTORE_REFRESH_TOKEN
.RS 4
Specifies the refresh token to use. If the \f(CR\-\-obj\-refresh\-token\fP argument is
provided in the command line, this value is overridden.
.RE
.sp
CB_AWS_ENABLE_EC2_METADATA
.RS 4
By default cbbackupmgr will disable fetching EC2 instance metadata. Setting
this environment variable to true will allow the AWS SDK to fetch metadata
from the EC2 instance endpoint.
.RE
.SH "SEE ALSO"
.sp
\fBcbbackupmgr\-info\fP(1),
.SH "CBBACKUPMGR"
.sp
Part of the \fBcbbackupmgr\fP(1) suite
.SH "AUTHOR"
.sp
Couchbase